<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Müşteri Listesi</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Eğer styles.css'e eklemeyi tercih etmediyseniz, temel stiller burada da yer alabilir. */
  </style>
</head>
<body>
<!-- Ortak Navbar (Sidebar) -->
<div class="sidebar">
  <h2><a href="index.html" style="text-decoration:none; color:inherit;">Admin Panel</a></h2>
  <div class="menu-item" id="bakim-menu">
    <div class="menu-title">Bakım</div>
    <ul class="submenu">
      <li><a href="bakim.html">Bakım Listesi</a></li>
      <li><a href="#">Bakım Düzenle</a></li>
    </ul>
  </div>
  <div class="menu-item" id="musteriler-menu">
    <div class="menu-title">Müşteriler</div>
    <ul class="submenu">
      <li><a href="musteriler.html">Müşteri Listesi</a></li>
      <li><a href="#">Müşteri Düzenle</a></li>
    </ul>
  </div>
  <a href="index.html">Admin Panel</a>
  <a href="bakim.html">Bakım</a>
  <a href="musteriler.html">Müşteriler</a>
</div>


<script>
  // Müşteri verilerini API'den çekmek için fonksiyon
  async function fetchMusteriler() {
    try {
      const response = await fetch('/api/musteriler');
      if (!response.ok) throw new Error("Müşteri verileri çekilemedi.");
      return await response.json();
    } catch (error) {
      console.error("Hata:", error);
      return [];
    }
  }

  // Müşteri tablosunu oluşturma fonksiyonu
  function renderMusterilerTable(data) {
    const tableBody = document.getElementById('musterilerTableBody');
    tableBody.innerHTML = "";
    data.forEach(item => {
      const row = document.createElement('tr');
      row.innerHTML = `
          <td>${item.ad}</td>
          <td>${item.borc}</td>
          <td>${item.sonkontrol}</td>
          <td>${item.numara || 'Yok'}</td>
        `;
      tableBody.appendChild(row);
    });
  }

  // Sayfa yüklendiğinde verileri çek ve tabloyu göster
  document.addEventListener("DOMContentLoaded", async () => {
    const data = await fetchMusteriler();
    document.querySelector('.loading').style.display = 'none';
    const table = document.getElementById('musterilerTable');
    table.style.display = 'table';
    renderMusterilerTable(data);
  });

  // Sütun başlıklarına tıklanarak sıralama (basit örnek)
  document.querySelectorAll("th[data-key]").forEach(header => {
    header.addEventListener("click", async () => {
      const key = header.getAttribute("data-key");
      let data = await fetchMusteriler();
      data.sort((a, b) => {
        if(a[key] < b[key]) return -1;
        if(a[key] > b[key]) return 1;
        return 0;
      });
      renderMusterilerTable(data);
    });
  });
</script>
</body>
</html>
